{{> header }}
{{> topNavigator }}

<script>
  addEventListener("load", (event) => {
    const icon1 = document.createElement("i");
    icon1.classList.add("material-icons");
    icon1.textContent = "chevron_right";
    const icon2 = document.createElement("i");
    icon2.classList.add("material-icons");
    icon2.textContent = "expand_more";
    $('#tree').tree({
      closedIcon: icon1,
      openedIcon: icon2,
      saveState: 'contents-tree-dashboard'
    });
  });
  function getAllNodes(data) {
    const ret = [];
    for(const dat of data) {
      if (dat.children && dat.children.length > 0) {
        ret.push(...getAllNodes(dat.children));
      }
      ret.push(dat.id);
    }
    return ret;
  }
  function searchTree() {
    const keyword = document.getElementById("treeKeyword").value;
    if (keyword === '') {
      $('#tree').tree('loadDataFromUrl', "{{baseUrl}}/api/contents/tree");
      $('#currentTreeKeywordText').text('');
      $('#currentTreeKeyword').addClass('d-none');
    } else {
      $('#tree').tree('loadDataFromUrl', "{{baseUrl}}/api/contents/tree?keyword=" + encodeURIComponent(keyword),null, ()=>{
        const data = $('#tree').tree('getTree').getData(true);
        for(const nodeid of getAllNodes(data)){
          if (nodeid){
            $('#tree').tree('openNode', $('#tree').tree('getNodeById', nodeid), false);
          }
        }
        $('#currentTreeKeywordText').text(keyword);
        $('#currentTreeKeyword').removeClass('d-none');
      });
    }
  }
</script>

<div class="container-fluid">
  <div class="row">
    <div class="col-md-3 leftmenu">
      <div id="treeviewArea">
        <div class="input-group">
          <input type="text" id="treeKeyword" class="form-control form-control-sm" placeholder="{{ __ 'page.contents.tree.search' }}" aria-label="Search" aria-describedby="button-addon2" onkeyup="if($('#treeKeyword').val() === '' || event.key === 'Enter'){ searchTree(); }">
          <button class="btn btn-outline-secondary btn-sm" type="button" onclick="searchTree()">{{ __ 'page.contents.tree.searchButton' }}</button>
        </div>
        <div id="currentTreeKeyword" class="d-none">
          <span class="">{{ __ 'page.contents.tree.searchWord' }}</span>:<span id="currentTreeKeywordText"></span>
        </div>
        <div id="tree" data-url="{{baseUrl}}/api/contents/tree"></div>
      </div>
    </div>
    <div class="col-md-9">
      {{#if false}}
      <nav style="--bs-breadcrumb-divider: url(&#34;data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8'%3E%3Cpath d='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z' fill='%236c757d'/%3E%3C/svg%3E&#34;);" aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item active"><a href="{{baseUrl}}/contents">Dashboard</a></li>
        </ol>
      </nav>
      {{/if}}
      <section id="main_section">
        <div id="contentArea">
          <!-- Content will be loaded here -->
          Contents
        </div>
      </section>
    </div>
  </div> <!-- row -->
</div>

{{> footer }}
